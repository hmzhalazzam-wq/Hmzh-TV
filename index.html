<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Hmzh TV - AI Knowledge V12</title>
    
    <!-- Ø§Ù„Ø®Ø·ÙˆØ· ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
    <link href="https://fonts.googleapis.com/css2?family=Alexandria:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dashjs/4.7.1/dash.all.min.js"></script>

    <style>
        /* ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª (Themes System) */
        :root {
            --primary: #3b82f6;
            --primary-glow: rgba(59, 130, 246, 0.5);
            --accent: #f43f5e;
            --bg-main: #0f172a;
            --bg-secondary: #1e293b;
            --border: rgba(255, 255, 255, 0.08);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --radius-lg: 24px;
            --radius-md: 16px;
            --sidebar-w: 280px;
        }

        [data-theme="gold"] { --primary: #fbbf24; --primary-glow: rgba(251, 191, 36, 0.5); }
        [data-theme="purple"] { --primary: #a855f7; --primary-glow: rgba(168, 85, 247, 0.5); }
        [data-theme="green"] { --primary: #10b981; --primary-glow: rgba(16, 185, 129, 0.5); }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        
        body {
            font-family: 'Alexandria', sans-serif;
            background-color: var(--bg-main);
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(255,255,255,0.03) 0%, transparent 50%),
                radial-gradient(circle at 100% 100%, rgba(255,255,255,0.03) 0%, transparent 50%);
            color: var(--text-main);
            margin: 0; padding: 0;
            height: 100vh;
            overflow: hidden;
            transition: 0.3s;
        }

        .layout { display: flex; height: 100vh; width: 100%; }

        /* === Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© === */
        .sidebar {
            width: var(--sidebar-w);
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-left: 1px solid var(--border);
            padding: 25px 20px;
            display: flex; flex-direction: column;
            gap: 8px; z-index: 100;
            overflow-y: auto;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        .logo-area {
            font-size: 24px; font-weight: 900;
            color: white; margin-bottom: 20px;
            display: flex; align-items: center; gap: 12px;
            letter-spacing: -1px;
        }
        .logo-icon {
            width: 40px; height: 40px; background: var(--primary); color: #000;
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px var(--primary-glow); transition: 0.3s;
        }

        .clock-widget {
            background: rgba(255,255,255,0.03); border: 1px solid var(--border);
            padding: 10px; border-radius: 12px; text-align: center;
            font-family: 'Courier New', monospace; font-weight: bold;
            color: var(--primary); letter-spacing: 2px; margin-bottom: 15px;
        }

        .section-label {
            font-size: 11px; font-weight: 700; color: var(--text-muted);
            margin: 15px 5px 5px 0; text-transform: uppercase; letter-spacing: 0.5px;
        }

        .nav-item {
            background: transparent; border: none; color: #cbd5e1;
            padding: 12px 16px; width: 100%; text-align: right;
            cursor: pointer; border-radius: var(--radius-md);
            font-family: 'Alexandria'; font-size: 13px; font-weight: 500;
            display: flex; align-items: center; gap: 12px;
            transition: all 0.2s ease;
        }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: white; transform: translateX(-3px); }
        .nav-item.active {
            background: linear-gradient(90deg, rgba(255,255,255,0.05), transparent);
            color: var(--primary); font-weight: 700;
            border-right: 3px solid var(--primary);
        }

        /* === Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ === */
        .main-view {
            flex: 1; padding: 30px;
            overflow-y: auto; display: flex; flex-direction: column;
            position: relative; width: 100%;
        }

        /* === Ù‚Ø³Ù… Ø§Ù„Ù…Ø´ØºÙ„ === */
        .hero-player {
            display: flex; flex-direction: column; gap: 20px;
            margin-bottom: 40px; animation: fadeIn 0.5s ease;
        }

        .video-frame {
            position: relative; width: 100%; aspect-ratio: 16/9;
            background: #000; border-radius: var(--radius-lg); overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
            border: 1px solid var(--border); max-height: 75vh;
        }

        video { width: 100%; height: 100%; object-fit: contain; transition: 0.3s; }

        .overlay-info {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: linear-gradient(to top, rgba(15, 23, 42, 0.95), transparent);
            padding: 40px 30px 25px;
            display: flex; justify-content: space-between; align-items: flex-end;
            opacity: 0; transition: 0.3s;
        }
        .video-frame:hover .overlay-info { opacity: 1; }

        .player-controls { display: flex; gap: 10px; }
        .p-btn {
            width: 40px; height: 40px; border-radius: 50%; border: none;
            background: rgba(255,255,255,0.1); color: white;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            backdrop-filter: blur(4px); transition: 0.2s;
        }
        .p-btn:hover { background: var(--primary); color: #000; transform: scale(1.1); }

        /* === Ø¨Ø·Ø§Ù‚Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø© (Ø§Ù„Ù…Ø­Ø³Ù†Ø©) === */
        .channel-info-card {
            background: var(--bg-secondary); border: 1px solid var(--border);
            border-radius: var(--radius-md); padding: 25px;
            display: flex; gap: 25px; align-items: flex-start;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .info-logo {
            width: 90px; height: 90px; background: rgba(0,0,0,0.2);
            border-radius: var(--radius-md); padding: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 35px; font-weight: bold; color: var(--text-muted);
            flex-shrink: 0;
        }
        .info-logo img { width: 100%; height: 100%; object-fit: contain; }

        .info-details { flex: 1; }
        .info-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
        .info-title { font-size: 26px; font-weight: 800; margin: 0; color: white; }
        .badge { font-size: 11px; padding: 4px 10px; border-radius: 20px; font-weight: 700; text-transform: uppercase; }
        .badge-live { background: var(--accent); color: white; box-shadow: 0 0 10px rgba(244, 63, 94, 0.4); }
        .badge-quality { background: rgba(255,255,255,0.1); color: #cbd5e1; border: 1px solid var(--border); }
        .badge-cat { background: var(--primary); color: #000; font-weight: 800; }
        
        .info-desc { 
            font-size: 14px; color: #cbd5e1; margin-top: 5px; line-height: 1.7; 
            background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px;
            border-left: 3px solid var(--primary); min-height: 60px;
        }
        .info-desc.loading-text {
            color: var(--text-muted); font-style: italic;
        }

        .guide-actions { display: flex; gap: 10px; margin-top: 10px; }
        .guide-btn {
            background: transparent; border: 1px solid var(--border);
            color: var(--primary); padding: 8px 15px; border-radius: 20px;
            font-size: 12px; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 5px; transition: 0.2s;
        }
        .guide-btn:hover { background: var(--primary); color: #000; }

        /* === Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ± === */
        .toolbar { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .search-wrapper { flex: 1; position: relative; min-width: 250px; }
        .search-wrapper input {
            width: 100%; background: var(--bg-secondary); border: 1px solid var(--border);
            padding: 16px 50px 16px 20px; border-radius: var(--radius-md); color: white;
            font-family: 'Alexandria'; font-size: 14px; transition: 0.3s;
        }
        .search-wrapper input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px var(--primary-glow); }
        .search-wrapper i { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }

        .action-btn {
            background: var(--bg-secondary); border: 1px solid var(--border);
            color: var(--text-muted); height: 52px; padding: 0 20px;
            border-radius: var(--radius-md); cursor: pointer;
            display: flex; align-items: center; gap: 8px; font-family: 'Alexandria'; font-weight: 600;
            transition: 0.2s;
        }
        .action-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }

        /* === Ø§Ù„Ø´Ø¨ÙƒØ© === */
        .channels-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
            gap: 20px; padding-bottom: 100px;
        }

        .card {
            background: var(--bg-secondary); border: 1px solid var(--border);
            border-radius: var(--radius-md); padding: 20px;
            position: relative; display: flex; flex-direction: column; align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; height: 180px; overflow: hidden;
        }
        .card:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }
        
        .card-img {
            width: 70px; height: 70px; margin-bottom: 15px;
            background: rgba(0,0,0,0.2); border-radius: 50%; padding: 5px;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; font-weight: 900; color: white;
        }
        .card-img img { width: 100%; height: 100%; object-fit: contain; border-radius: 50%; }
        .card-title {
            font-size: 13px; font-weight: 700; text-align: center; color: var(--text-main);
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
        }
        .fav-icon {
            position: absolute; top: 12px; left: 12px;
            color: rgba(255,255,255,0.1); font-size: 18px; transition: 0.2s;
        }
        .fav-icon:hover, .fav-icon.active { color: var(--accent); transform: scale(1.2); }

        /* === Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Pro Toasts) === */
        .toast-container {
            position: fixed; top: 20px; right: 20px; /* ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù„Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
            z-index: 2000; display: flex; flex-direction: column; gap: 10px;
            pointer-events: none;
        }
        .toast {
            background: rgba(15, 23, 42, 0.85); 
            border: 1px solid var(--border);
            backdrop-filter: blur(12px);
            color: white; padding: 15px 20px; 
            border-radius: 12px;
            min-width: 250px;
            font-size: 13px; font-weight: 600; 
            display: flex; align-items: center; gap: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3); 
            animation: slideInRight 0.3s ease;
            position: relative; overflow: hidden;
            pointer-events: auto;
        }
        .toast i { font-size: 18px; }
        
        .toast-progress {
            position: absolute; bottom: 0; right: 0; left: 0; height: 3px;
            background: var(--primary);
            animation: progress 3s linear forwards;
        }

        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes progress { from { width: 100%; } to { width: 0%; } }

        /* === Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª === */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.7); z-index: 1500; backdrop-filter: blur(5px);
            display: none; justify-content: center; align-items: center;
        }
        .settings-box {
            background: var(--bg-secondary); border: 1px solid var(--border);
            padding: 25px; border-radius: var(--radius-lg); width: 300px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); animation: popIn 0.3s;
        }
        @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .color-opts { display: flex; gap: 15px; margin-top: 15px; justify-content: center; }
        .color-btn {
            width: 40px; height: 40px; border-radius: 50%; cursor: pointer;
            border: 2px solid transparent; transition: 0.2s;
        }
        .color-btn:hover { transform: scale(1.1); border-color: white; }

        /* Mobile Nav */
        .bottom-nav {
            display: none; position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px);
            border-top: 1px solid var(--border); padding: 10px 20px;
            justify-content: space-between; z-index: 500;
        }
        .b-item {
            background: none; border: none; color: var(--text-muted);
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            font-size: 10px; font-family: 'Alexandria'; font-weight: 600;
        }
        .b-item.active { color: var(--primary); }
        .b-item i { font-size: 20px; }

        .loading { grid-column: 1/-1; text-align: center; padding: 50px; color: var(--text-muted); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .bottom-nav { display: flex; }
            .main-view { padding: 15px; }
            .channel-info-card { flex-direction: column; text-align: center; gap: 15px; }
            .info-header { justify-content: center; flex-wrap: wrap; }
            .card { height: 160px; }
            .info-logo { margin: 0 auto; }
            .guide-actions { justify-content: center; }
            .toast-container { right: 50%; transform: translateX(50%); width: 90%; top: 10px; }
        }
    </style>
</head>
<body>

<div class="layout">
    
    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <aside class="sidebar">
        <div class="logo-area">
            <div class="logo-icon"><i class="fas fa-play"></i></div>
            HMZH TV <span style="font-size:10px; opacity:0.7">V12</span>
        </div>

        <div class="clock-widget" id="clock">00:00:00</div>
        
        <div class="section-label">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <button class="nav-item active" onclick="loadCategory('ara', this)"><i class="fas fa-globe"></i> Ù‚Ù†ÙˆØ§Øª Ø¹Ø±Ø¨ÙŠØ©</button>
        <button class="nav-item" onclick="showHistory(this)"><i class="fas fa-history"></i> Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø¤Ø®Ø±Ø§Ù‹</button>
        <button class="nav-item" onclick="showFavorites(this)"><i class="fas fa-heart" style="color:var(--accent)"></i> Ø§Ù„Ù…ÙØ¶Ù„Ø©</button>

        <div class="section-label">Ø¯ÙˆÙ„</div>
        <button class="nav-item" onclick="loadCategory('sa', this)">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</button>
        <button class="nav-item" onclick="loadCategory('eg', this)">ğŸ‡ªğŸ‡¬ Ù…ØµØ±</button>
        <button class="nav-item" onclick="loadCategory('ae', this)">ğŸ‡¦ğŸ‡ª Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</button>
        <button class="nav-item" onclick="loadCategory('kw', this)">ğŸ‡°ğŸ‡¼ Ø§Ù„ÙƒÙˆÙŠØª</button>

        <div class="section-label">ØªØµÙ†ÙŠÙØ§Øª</div>
        <button class="nav-item" onclick="loadCategory('sports', this)"><i class="fas fa-futbol"></i> Ø±ÙŠØ§Ø¶Ø©</button>
        <button class="nav-item" onclick="loadCategory('news', this)"><i class="fas fa-newspaper"></i> Ø£Ø®Ø¨Ø§Ø±</button>
        <button class="nav-item" onclick="loadCategory('kids', this)"><i class="fas fa-gamepad"></i> Ø£Ø·ÙØ§Ù„</button>

        <div style="margin-top:auto"></div>
        <button class="nav-item" onclick="openSettings()"><i class="fas fa-cog"></i> Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„Ù…Ø¸Ù‡Ø±</button>
    </aside>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
    <main class="main-view">
        
        <!-- Ø§Ù„Ù…Ø´ØºÙ„ -->
        <div class="hero-player">
            <div class="video-frame" id="videoFrame">
                <video id="player" autoplay muted playsinline></video>
                <div class="overlay-info">
                    <span class="badge badge-live" id="liveIndicator" style="background:#444">READY</span>
                    <div class="player-controls">
                        <button class="p-btn" onclick="toggleMute()" title="ÙƒØªÙ… Ø§Ù„ØµÙˆØª"><i id="muteIcon" class="fas fa-volume-mute"></i></button>
                        <button class="p-btn" onclick="togglePiP()" title="ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„ ØµÙˆØ±Ø©"><i class="fas fa-clone"></i></button>
                        <button class="p-btn" onclick="toggleAspect()" title="ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯"><i class="fas fa-expand-alt"></i></button>
                        <button class="p-btn" onclick="toggleFullscreen()" title="Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©"><i class="fas fa-expand"></i></button>
                    </div>
                </div>
            </div>

            <div class="channel-info-card">
                <div class="info-logo" id="infoLogo"><i class="fas fa-tv"></i></div>
                <div class="info-details">
                    <div class="info-header">
                        <h1 class="info-title" id="infoTitle">Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø© Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</h1>
                        <span class="badge badge-quality" id="infoQuality">HD</span>
                        <span class="badge badge-cat" id="infoCat">Ø¹Ø§Ù…</span>
                    </div>
                    <div class="info-desc" id="infoDesc">
                        Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Hmzh TV. Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù‚Ù†Ø§Ø© ÙˆØ³Ø£Ù‚ÙˆÙ… Ø¨Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙ‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ùƒ!
                    </div>
                    <div class="guide-actions">
                        <button class="guide-btn" onclick="searchGoogleSchedule()">
                            <i class="fab fa-google"></i> Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬
                        </button>
                        <button class="guide-btn" onclick="shareChannel()">
                            <i class="fas fa-share-alt"></i> Ù…Ø´Ø§Ø±ÙƒØ©
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
        <div class="toolbar">
            <div class="search-wrapper">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Ø¨Ø­Ø« Ø°ÙƒÙŠ..." onkeyup="smartSearch()">
            </div>
            <button class="action-btn" onclick="playRandom()"><i class="fas fa-dice"></i> Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
            <button class="action-btn" onclick="refreshList()"><i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«</button>
        </div>

        <!-- Ø§Ù„Ø´Ø¨ÙƒØ© -->
        <div class="channels-grid" id="grid"></div>

    </main>

    <!-- Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
    <nav class="bottom-nav">
        <button class="b-item active" onclick="loadCategory('ara', this)"><i class="fas fa-home"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button class="b-item" onclick="loadCategory('sports', this)"><i class="fas fa-futbol"></i> Ø±ÙŠØ§Ø¶Ø©</button>
        <button class="b-item" onclick="showFavorites(this)"><i class="fas fa-heart"></i> Ø§Ù„Ù…ÙØ¶Ù„Ø©</button>
        <button class="b-item" onclick="openSettings()"><i class="fas fa-cog"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </nav>

    <!-- Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
    <div class="modal-overlay" id="settingsModal" onclick="closeSettings(event)">
        <div class="settings-box">
            <h2 style="text-align:center; margin-top:0">ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø¸Ù‡Ø±</h2>
            <p style="text-align:center; color:var(--text-muted)">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ù…ÙØ¶Ù„ Ù„Ø¯ÙŠÙƒ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚</p>
            <div class="color-opts">
                <div class="color-btn" style="background:#3b82f6" onclick="setTheme('blue')"></div>
                <div class="color-btn" style="background:#fbbf24" onclick="setTheme('gold')"></div>
                <div class="color-btn" style="background:#a855f7" onclick="setTheme('purple')"></div>
                <div class="color-btn" style="background:#10b981" onclick="setTheme('green')"></div>
            </div>
            <button class="action-btn" style="width:100%; margin-top:20px; justify-content:center" onclick="closeSettings(null, true)">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

</div>

<script>
    // === Ø§Ù„Ù†Ø¸Ø§Ù… ===
    const video = document.getElementById('player');
    const grid = document.getElementById('grid');
    let hls = null;
    let allChannels = [];
    let favorites = JSON.parse(localStorage.getItem('hmzh_favs_v9')) || [];
    let history = JSON.parse(localStorage.getItem('hmzh_hist_v9')) || [];
    let savedTheme = localStorage.getItem('hmzh_theme_v10') || 'blue';
    let currentChannelName = "";

    const sources = {
        'ara': 'https://iptv-org.github.io/iptv/languages/ara.m3u',
        'sa': 'https://iptv-org.github.io/iptv/countries/sa.m3u',
        'eg': 'https://iptv-org.github.io/iptv/countries/eg.m3u',
        'ae': 'https://iptv-org.github.io/iptv/countries/ae.m3u',
        'kw': 'https://iptv-org.github.io/iptv/countries/kw.m3u',
        'sports': 'https://iptv-org.github.io/iptv/categories/sports.m3u',
        'news': 'https://iptv-org.github.io/iptv/categories/news.m3u',
        'kids': 'https://iptv-org.github.io/iptv/categories/kids.m3u',
        'doc': 'https://iptv-org.github.io/iptv/categories/documentary.m3u'
    };

    const catMap = {'General':'Ø¹Ø§Ù…','Entertainment':'ØªØ±ÙÙŠÙ‡','Movies':'Ø£ÙÙ„Ø§Ù…','News':'Ø£Ø®Ø¨Ø§Ø±','Kids':'Ø£Ø·ÙØ§Ù„','Music':'Ù…ÙˆØ³ÙŠÙ‚Ù‰','Sports':'Ø±ÙŠØ§Ø¶Ø©','Documentary':'ÙˆØ«Ø§Ø¦Ù‚ÙŠ'};

    window.onload = () => {
        setTheme(savedTheme);
        startClock();
        loadCategory('ara', document.querySelector('.nav-item.active'));
        
        // Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©
        const lastCh = history[0];
        if(lastCh) {
            showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªÙƒÙ…Ø§Ù„ ${lastCh.name}ØŸ`, 'info');
        }
    };

    // === Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ===
    async function loadCategory(key, btn) {
        updateUI(btn);
        grid.innerHTML = '<div class="loading"><i class="fas fa-circle-notch fa-spin fa-2x"></i><br><br>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
        try {
            const res = await fetch(sources[key]);
            const text = await res.text();
            allChannels = parseM3U(text);
            allChannels.sort((a, b) => a.name.localeCompare(b.name));
            renderGrid(allChannels);
        } catch (e) {
            grid.innerHTML = '<div class="loading" style="color:var(--accent)">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„</div>';
        }
    }

    function parseM3U(data) {
        const lines = data.split('\n');
        const res = [];
        let ch = {};
        lines.forEach(line => {
            line = line.trim();
            if(line.startsWith('#EXTINF:')) {
                const logo = line.match(/tvg-logo="([^"]*)"/);
                const group = line.match(/group-title="([^"]*)"/);
                let name = line.split(',')[1] || "Unknown";
                name = name.replace(/\[.*?\]/g, '').replace(/\(.*\)/g, '').trim();
                let grp = group ? group[1] : "Ø¹Ø§Ù…";
                grp = catMap[grp] || grp;
                ch = { name, logo: logo?logo[1]:null, group: grp };
            } else if(line.startsWith('http')) {
                ch.url = line;
                if(ch.name && !ch.name.toLowerCase().includes('xxx')) res.push({...ch});
                ch = {};
            }
        });
        return res;
    }

    function renderGrid(list) {
        grid.innerHTML = '';
        const limit = list.slice(0, 300);
        if(limit.length === 0) { grid.innerHTML = '<div class="loading">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>'; return; }

        limit.forEach(ch => {
            const isFav = favorites.some(f => f.url === ch.url);
            const card = document.createElement('div');
            card.className = 'card';
            let icon = ch.logo ? `<img src="${ch.logo}" loading="lazy" onerror="this.parentElement.innerText='${ch.name[0]}'"/>` : ch.name[0];
            
            card.innerHTML = `
                <i class="fas fa-heart fav-icon ${isFav?'active':''}" onclick="toggleFav(event, '${ch.url}', '${ch.name}', '${ch.logo}', '${ch.group}')"></i>
                <div class="card-img">${icon}</div>
                <div class="card-title">${ch.name}</div>
            `;
            card.onclick = (e) => { if(!e.target.classList.contains('fav-icon')) playChannel(ch); };
            grid.appendChild(card);
        });
    }

    // === Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† ÙˆÙŠÙƒÙŠØ¨ÙŠØ¯ÙŠØ§ (Automated AI Fetching) ===
    async function fetchWikiInfo(query) {
        try {
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø§Ø³Ù… Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ø£ÙØ¶Ù„ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«
            const cleanName = query.replace(/HD|SD|TV|Channel|Ù‚Ù†Ø§Ø©/gi, '').trim();
            const res = await fetch(`https://ar.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(cleanName)}`);
            if(res.ok) {
                const data = await res.json();
                if(data.extract) return data.extract;
            }
        } catch(e) { console.log("Wiki fetch failed"); }
        return null;
    }

    // === Ø§Ù„Ù…Ø´ØºÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… ÙˆØ§Ù„Ø°ÙƒÙŠ ===
    async function playChannel(ch) {
        currentChannelName = ch.name;
        document.getElementById('infoTitle').innerText = ch.name;
        document.getElementById('liveIndicator').innerText = "CONNECTING";
        document.getElementById('liveIndicator').style.background = "#eab308";
        
        // 1. Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        document.getElementById('infoDesc').innerHTML = `<span class="loading-text"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù‚Ù†Ø§Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ù…ÙˆØ³ÙˆØ¹Ø© Ø§Ù„Ø­Ø±Ø©...</span>`;
        document.getElementById('infoCat').innerText = ch.group;

        // 2. Ù…Ø­Ø§ÙˆÙ„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù† ÙˆÙŠÙƒÙŠØ¨ÙŠØ¯ÙŠØ§
        const wikiInfo = await fetchWikiInfo(ch.name);
        
        if (wikiInfo) {
            document.getElementById('infoDesc').innerText = wikiInfo;
        } else {
            // 3. Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
            let desc = `Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù‚Ù†Ø§Ø© <b>${ch.name}</b>. `;
            if(ch.group === 'Ø±ÙŠØ§Ø¶Ø©') desc += "ØªØ§Ø¨Ø¹ Ø£Ù‡Ù… Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ù…Ù†Ø§ÙØ³Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©.";
            else if(ch.group === 'Ø£Ø®Ø¨Ø§Ø±') desc += "ØªØºØ·ÙŠØ© Ø¥Ø®Ø¨Ø§Ø±ÙŠØ© Ù…Ø³ØªÙ…Ø±Ø© Ù„Ù„Ø£Ø­Ø¯Ø§Ø«.";
            else if(ch.group === 'Ø£ÙÙ„Ø§Ù…') desc += "Ø£Ø­Ø¯Ø« Ø§Ù„Ø£ÙÙ„Ø§Ù… ÙˆØ§Ù„Ø³ÙŠÙ†Ù…Ø§.";
            else desc += `ØªØµÙ†ÙŠÙ Ø§Ù„Ù‚Ù†Ø§Ø©: ${ch.group}. Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø¬ÙˆØ¯Ø© Ø¨Ø« Ø¹Ø§Ù„ÙŠØ©.`;
            document.getElementById('infoDesc').innerHTML = desc;
        }

        const infoLogo = document.getElementById('infoLogo');
        infoLogo.innerHTML = ch.logo ? `<img src="${ch.logo}" onerror="this.parentElement.innerText='${ch.name[0]}'"/>` : ch.name[0];
        document.getElementById('infoQuality').innerText = (ch.name.includes('HD') || ch.name.includes('1080')) ? "FULL HD" : "SD";

        addToHistory(ch);
        window.scrollTo({top:0, behavior:'smooth'});

        if(hls) { hls.destroy(); hls = null; }

        if(Hls.isSupported() && (ch.url.endsWith('m3u8') || ch.url.includes('m3u8'))) {
            hls = new Hls();
            hls.loadSource(ch.url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                video.play().catch(()=>{});
                setLiveState();
                showToast(`ØªÙ… ØªØ´ØºÙŠÙ„: ${ch.name}`, 'success');
            });
            hls.on(Hls.Events.ERROR, () => { setOfflineState(); showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø«', 'error'); });
        } else {
            video.src = ch.url;
            video.play().then(()=>{ setLiveState(); showToast(`ØªÙ… ØªØ´ØºÙŠÙ„: ${ch.name}`, 'success'); }).catch(()=>{ setOfflineState(); showToast('Ø®Ø·Ø£: Ø§Ù„ØµÙŠØºØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©', 'error'); });
        }
    }

    function searchGoogleSchedule() {
        if(currentChannelName) {
            const query = `Ø¬Ø¯ÙˆÙ„ Ø¨Ø±Ø§Ù…Ø¬ Ù‚Ù†Ø§Ø© ${currentChannelName}`;
            window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
        } else {
            showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ù†Ø§Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
        }
    }

    function shareChannel() {
        if(currentChannelName) {
            const text = `Ø£Ø´Ø§Ù‡Ø¯ Ù‚Ù†Ø§Ø© ${currentChannelName} Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ Hmzh TV!`;
            if(navigator.share) {
                navigator.share({ title: 'Hmzh TV', text: text, url: window.location.href });
            } else {
                navigator.clipboard.writeText(text + " " + window.location.href);
                showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·!', 'success');
            }
        } else {
            showToast('Ø§Ø®ØªØ± Ù‚Ù†Ø§Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©', 'info');
        }
    }

    function setLiveState() { document.getElementById('liveIndicator').innerText = "LIVE NOW"; document.getElementById('liveIndicator').style.background = "#f43f5e"; }
    function setOfflineState() { document.getElementById('liveIndicator').innerText = "OFFLINE"; document.getElementById('liveIndicator').style.background = "#64748b"; }

    // === Ø§Ù„Ù…ÙŠØ²Ø§Øª (V10) ===
    function showToast(msg, type='info') {
        const t = document.createElement('div');
        t.className = 'toast';
        let icon = type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle';
        let color = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : 'var(--primary)';
        
        // Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        t.innerHTML = `
            <i class="fas fa-${icon}" style="color:${color}"></i> ${msg}
            <div class="toast-progress"></div>
        `;
        document.getElementById('toastContainer').appendChild(t);
        setTimeout(() => { t.style.opacity='0'; setTimeout(()=>t.remove(), 300); }, 3000);
    }

    async function togglePiP() {
        try {
            if (document.pictureInPictureElement) await document.exitPictureInPicture();
            else await video.requestPictureInPicture();
        } catch(e) { showToast('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… PiP', 'error'); }
    }

    function toggleAspect() {
        video.style.objectFit = video.style.objectFit === 'cover' ? 'contain' : 'cover';
        showToast(video.style.objectFit === 'cover' ? 'ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©' : 'ÙˆØ¶Ø¹ Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡ Ø§Ù„ÙƒØ§Ù…Ù„');
    }

    function startClock() {
        setInterval(() => {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('en-US', {hour12:false});
        }, 1000);
    }

    function openSettings() { document.getElementById('settingsModal').style.display = 'flex'; }
    function closeSettings(e, force=false) { if(force || e.target.id === 'settingsModal') document.getElementById('settingsModal').style.display = 'none'; }

    function setTheme(theme) {
        document.body.removeAttribute('data-theme');
        if(theme !== 'blue') document.body.setAttribute('data-theme', theme);
        localStorage.setItem('hmzh_theme_v10', theme);
        savedTheme = theme;
        showToast('ØªÙ… ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'success');
    }

    // === Ø£Ø¯ÙˆØ§Øª Ù‚Ø¯ÙŠÙ…Ø© ===
    function toggleFav(e, url, name, logo, group) {
        e.stopPropagation();
        const idx = favorites.findIndex(f => f.url === url);
        if(idx > -1) { favorites.splice(idx, 1); showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©'); }
        else { favorites.push({url, name, logo, group}); showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©', 'success'); }
        localStorage.setItem('hmzh_favs_v9', JSON.stringify(favorites));
        renderGrid(allChannels);
    }

    function showFavorites(btn) { updateUI(btn); renderGrid(favorites); }
    function addToHistory(ch) { history = history.filter(h => h.url !== ch.url); history.unshift(ch); if(history.length > 20) history.pop(); localStorage.setItem('hmzh_hist_v9', JSON.stringify(history)); }
    function showHistory(btn) { updateUI(btn); renderGrid(history); }
    function smartSearch() { const q = document.getElementById('searchInput').value.toLowerCase(); const res = allChannels.filter(c => c.name.toLowerCase().includes(q) || c.group.toLowerCase().includes(q)); renderGrid(res); }
    function playRandom() { if(allChannels.length > 0) playChannel(allChannels[Math.floor(Math.random() * allChannels.length)]); }
    function toggleMute() { video.muted = !video.muted; document.getElementById('muteIcon').className = video.muted ? 'fas fa-volume-mute' : 'fas fa-volume-up'; showToast(video.muted ? 'ØªÙ… ÙƒØªÙ… Ø§Ù„ØµÙˆØª' : 'ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª'); }
    function toggleFullscreen() { const f = document.getElementById('videoFrame'); if(!document.fullscreenElement) f.requestFullscreen(); else document.exitFullscreen(); }
    function updateUI(btn) { if(!btn) return; document.querySelectorAll('.nav-item, .b-item').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
    function refreshList() { const active = document.querySelector('.nav-item.active') || document.querySelector('.b-item.active'); if(active) active.click(); showToast('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...'); }
</script>
</body>
</html>
